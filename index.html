<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Neon Orbit ‚Äî Icons + Bomb (Fixed Sizes)</title>
<style>
  :root{ --bg:#090a16; --card:#0f1226; --ring:#2a2e58; --ink:#eef4ff; --mut:#9fb0d9; --g1:#ff6ec4; --g2:#7873f5; --ok:#aef7c1; --bad:#ffb3be; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(1100px 700px at 20% -10%, #101435 0%, #090a16 55%, #060812 100%);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden}
  #game-root{position:fixed;inset:0}
  .hud{position:fixed;left:0;right:0;top:0;display:flex;gap:8px;padding:10px;pointer-events:none}
  .chip{background:rgba(12,18,48,.75);border:1px solid #223;border-radius:12px;padding:8px 10px;pointer-events:auto;display:flex;align-items:center;gap:8px;backdrop-filter:blur(8px)}
  .bar{height:10px;border-radius:999px;background:#0c1130;border:1px solid #223;overflow:hidden;width:180px}
  .bar>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--g1),var(--g2));transition:width .2s}
  .overlay{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg,rgba(10,7,24,.6),rgba(9,10,22,.9))}
  .panel{width:min(540px,92%);background:var(--card);border:1px solid var(--ring);border-radius:18px;padding:22px;box-shadow:0 0 60px rgba(120,115,245,.25), inset 0 0 0 1px rgba(255,255,255,.02)}
  h1{margin:0 0 6px;font-size:22px}.mut{color:var(--mut)} .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .btn{padding:12px 14px;background:#10163b;color:var(--ink);border:1px solid #2a2e58;border-radius:12px;cursor:pointer;font-weight:700}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .note{font-size:12px;color:var(--mut);margin-top:6px}
  .footer{position:fixed;bottom:8px;left:0;right:0;text-align:center;color:#9fb0d9;font-size:11px;pointer-events:none}
  .flash{position:fixed;inset:0;background:#fff;opacity:0;pointer-events:none;transition:opacity .12s}
</style>
</head>
<body>
<div id="game-root"></div>

<!-- HUD -->
<div class="hud" id="hud">
  <div class="chip"><span>Level</span><b id="hudLevel">1</b></div>
  <div class="chip"><span>XP</span><div class="bar"><i id="xpBar"></i></div></div>
  <div class="chip"><span>Coins</span><b id="hudCoins">0</b></div>
  <div class="chip"><span>Lives</span><b id="hudLives">3</b></div>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay">
  <div class="panel">
    <h1 id="ovTitle">Neon Orbit</h1>
    <p class="mut" id="ovText">Drag or tap to move. Collect <b>icons</b>, avoid <b>bombs</b>. Beat the goal to clear the level.</p>
    <div class="grid">
      <button class="btn" id="btnStart">‚ñ∂ Start</button>
      <button class="btn" id="btnResume" style="display:none">‚èØ Resume</button>
      <button class="btn" id="btnUpgradeSpeed">‚ö° Speed +1<br><span class="note" id="speedCost">Cost: 20</span></button>
      <button class="btn" id="btnUpgradeMagnet">üß≤ Magnet +10%<br><span class="note" id="magCost">Cost: 25</span></button>
      <button class="btn" id="btnNext" style="display:none">‚û° Next Level</button>
      <button class="btn" id="btnRestart" style="display:none">‚Üª Restart</button>
    </div>
    <div class="note" id="ovNote"></div>
  </div>
</div>

<div class="flash" id="flash"></div>
<div class="footer">Neon Orbit ‚Äî icons+bomb build (fixed sizes)</div>

<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.js"></script>
<script>
/* ================== CONFIG / ASSETS ================== */
const ASSETS = {
  icons: [
    'https://raw.githubusercontent.com/icons8/flat-color-icons/master/svg/like.svg',
    'https://raw.githubusercontent.com/icons8/flat-color-icons/master/svg/idea.svg',
    'https://raw.githubusercontent.com/icons8/flat-color-icons/master/svg/star.svg'
  ],
  bomb: 'https://raw.githubusercontent.com/tabler/tabler-icons/master/icons/filled/bomb.svg'
};
// Force on-screen sizes (change these!)
const ICON_SIZE = 48;   // px, collectibles
const BOMB_SIZE = 56;   // px, hazard
const ICON_VALUES = [1,2,5];

const SAVE_KEY = 'neon_orbit_progress_v3';
const Save = {
  data: { level:1, xp:0, coins:0, lives:3, speed:220, magnet:0.0, best:0 },
  load(){ try{ const raw=localStorage.getItem(SAVE_KEY); if(raw) Object.assign(this.data, JSON.parse(raw)||{});}catch(e){} },
  save(){ localStorage.setItem(SAVE_KEY, JSON.stringify(this.data)); }
}; Save.load();

const Levels = [
  { goal:12, time:45, hazards:3, spawn:1.0, enemySpeed:90 },
  { goal:18, time:50, hazards:4, spawn:0.9, enemySpeed:110 },
  { goal:25, time:55, hazards:5, spawn:0.8, enemySpeed:130 },
  { goal:32, time:60, hazards:6, spawn:0.7, enemySpeed:150 },
  { goal:42, time:65, hazards:7, spawn:0.6, enemySpeed:170 },
];
const xpNeeded = l => 50 + (l-1)*50;

/* ================== HUD refs ================== */
const hudLevel = document.getElementById('hudLevel');
const xpBar   = document.getElementById('xpBar');
const hudCoins= document.getElementById('hudCoins');
const hudLives= document.getElementById('hudLives');
const overlay = document.getElementById('overlay');
const ovTitle = document.getElementById('ovTitle');
const ovText  = document.getElementById('ovText');
const ovNote  = document.getElementById('ovNote');
const btnStart= document.getElementById('btnStart');
const btnResume=document.getElementById('btnResume');
const btnNext = document.getElementById('btnNext');
const btnRestart=document.getElementById('btnRestart');
const btnUS   = document.getElementById('btnUpgradeSpeed');
const btnUM   = document.getElementById('btnUpgradeMagnet');
const speedCostEl=document.getElementById('speedCost');
const magCostEl  =document.getElementById('magCost');
const flashEl = document.getElementById('flash');

function refreshHUD(){
  hudLevel.textContent = Save.data.level;
  hudCoins.textContent = Math.floor(Save.data.coins);
  hudLives.textContent = Save.data.lives;
  const need = xpNeeded(Save.data.level);
  xpBar.style.width = `${Math.min(100, (Save.data.xp/need)*100)}%`;
  const spdLvl=(Save.data.speed-220)/50, magLvl=Math.round(Save.data.magnet*10);
  speedCostEl.textContent = `Cost: ${20 + spdLvl*20}`;
  magCostEl.textContent   = `Cost: ${25 + magLvl*25}`;
}

/* ================== AUDIO (WebAudio) ================== */
const Audio = (() => {
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  window.addEventListener('pointerdown', ()=>ctx.resume(), {once:true});
  function beep(f=880,d=120,t='sine',v=.2){ const o=ctx.createOscillator(), g=ctx.createGain();
    o.type=t; o.frequency.value=f; g.gain.value=v; o.connect(g); g.connect(ctx.destination);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+d/1000); o.stop(ctx.currentTime+d/1000+0.01); }
  function boom(){ const o=ctx.createOscillator(), g=ctx.createGain(); o.type='triangle';
    o.frequency.setValueAtTime(140, ctx.currentTime); o.frequency.exponentialRampToValueAtTime(40, ctx.currentTime+.45);
    g.gain.value=.5; o.connect(g); g.connect(ctx.destination); o.start(); g.gain.exponentialRampToValueAtTime(.0001, ctx.currentTime+.46); o.stop(ctx.currentTime+.48); }
  return { collect:()=>beep(1000,100,'sine',.15), level:()=>beep(1500,160,'triangle',.22), boom, fail:()=>beep(120,300,'square',.25) };
})();

/* ================== Phaser ================== */
const game = new Phaser.Game({
  type: Phaser.AUTO,
  parent: 'game-root',
  width: innerWidth, height: innerHeight,
  backgroundColor: '#0a0718',
  physics: { default:'arcade', arcade:{ gravity:{y:0}, debug:false } },
  scale: { mode: Phaser.Scale.RESIZE, autoCenter: Phaser.Scale.CENTER_BOTH },
  scene: { preload, create, update }
});

let player, orbs, bombs, infoText, left=0, goal=0, collected=0, hazardSpeed=120, timer, spawnTimer;

function preload(){
  ASSETS.icons.forEach((url,i)=> this.load.image('icon'+i,url));
  this.load.image('bomb', ASSETS.bomb);
  // tiny 1px for particles
  this.textures.once('onload', ()=>{ const c=document.createElement('canvas'); c.width=c.height=2; const x=c.getContext('2d'); x.fillStyle='#fff'; x.fillRect(0,0,2,2); this.textures.addBase64('white', c.toDataURL()); });
}

function create(){
  const cw=this.scale.width, ch=this.scale.height;
  refreshHUD();

  // bg stars
  this.add.particles(0,0,'white',{ speed:10, lifespan:6000, quantity:1, scale:{start:.8,end:0}, alpha:.25,
    emitZone:{ type:'random', source:new Phaser.Geom.Rectangle(0,0,cw,ch)}});

  // player (simple circle)
  player = this.add.circle(cw*0.5, ch*0.5, 16, 0x78f3ff); this.physics.add.existing(player);
  player.body.setCircle(16).setCollideWorldBounds(true);
  player.maxSpeed = Save.data.speed;

  orbs  = this.physics.add.group();
  bombs = this.physics.add.group();

  // level params
  const L = Levels[(Save.data.level-1) % Levels.length];
  goal=L.goal; left=L.time; hazardSpeed=L.enemySpeed; collected=0;

  spawnTimer = this.time.addEvent({ delay:L.spawn*1000, loop:true, callback:()=>spawnIcon.call(this) });
  for(let i=0;i<L.hazards;i++) spawnBomb.call(this);

  infoText = this.add.text(12, ch-24, '', { font:'14px system-ui', fill:'#9fb0d9' }).setDepth(5);

  // input
  this.input.on('pointerdown', p=> moveTo.call(this,p));
  this.input.on('pointermove', p=> { if(p.isDown) moveTo.call(this,p); });

  // collisions
  this.physics.add.overlap(player, orbs, (_p, orb)=> collectIcon.call(this, orb));
  this.physics.add.overlap(player, bombs, (_p, b)=> hitBomb.call(this, b));

  // countdown
  timer = this.time.addEvent({ delay:1000, loop:true, callback:()=>{ left--; if(left<=0) levelEnd.call(this,false); }});
}

function update(){
  // magnet
  const r = 48 + 160*Save.data.magnet;
  orbs.getChildren().forEach(o=>{
    const dx=player.x-o.x, dy=player.y-o.y, d2=dx*dx+dy*dy;
    if(d2<r*r){ const v=new Phaser.Math.Vector2(dx,dy).normalize().scale(180);
      o.body.velocity.x += v.x * this.game.loop.delta/1000;
      o.body.velocity.y += v.y * this.game.loop.delta/1000; }
  });
  infoText.setText(`Goal ${collected}/${goal} ‚Ä¢ Time ${left}s`);
}

function moveTo(p){
  const v = new Phaser.Math.Vector2(p.x-player.x, p.y-player.y).normalize().scale(player.maxSpeed);
  player.body.setVelocity(v.x, v.y);
}

/* ====== FIXED-SIZE SPAWNERS ====== */
function spawnIcon(){
  const x = Phaser.Math.Between(24, this.scale.width-24);
  const y = Phaser.Math.Between(24, this.scale.height-24);
  const idx = Phaser.Math.Between(0, ASSETS.icons.length-1);

  const s = this.physics.add.image(x, y, 'icon'+idx);
  // Force on-screen size regardless of source image dimensions
  s.setDisplaySize(ICON_SIZE, ICON_SIZE);

  // Round-ish hitbox matching the displayed size
  const r = ICON_SIZE * 0.35;
  s.body.setCircle(r, -r, -r)
        .setBounce(1,1).setCollideWorldBounds(true)
        .setVelocity(Phaser.Math.Between(-40,40), Phaser.Math.Between(-40,40));

  s.setData('value', ICON_VALUES[idx]||1);
  orbs.add(s);
}

function spawnBomb(){
  const pad=30;
  const x = Phaser.Math.Between(pad, this.scale.width-pad);
  const y = Phaser.Math.Between(pad, this.scale.height-pad);

  const b = this.physics.add.image(x, y, 'bomb');
  b.setDisplaySize(BOMB_SIZE, BOMB_SIZE);

  const r = BOMB_SIZE * 0.32;
  b.body.setCircle(r, -r, -r)
        .setBounce(1,1).setCollideWorldBounds(true)
        .setVelocity(Phaser.Math.Between(-hazardSpeed,hazardSpeed), Phaser.Math.Between(-hazardSpeed,hazardSpeed));

  bombs.add(b);
}

/* ====== GAMEPLAY ====== */
function collectIcon(orb){
  const val = orb.getData('value')||1;
  orb.destroy();
  collected++; Save.data.coins += val; Save.data.xp += 4 + val;
  const p = this.add.particles(orb.x, orb.y, 'white', { lifespan:400, speed:120, quantity:10, scale:{start:1,end:0}, tint:[0xff6ec4,0x7873f5]});
  this.time.delayedCall(400, ()=>p.destroy());
  Audio.collect();
  if(collected>=goal) levelEnd.call(this,true);
  refreshHUD(); Save.save();
}

function hitBomb(b){
  b.destroy();
  this.cameras.main.shake(200, 0.01);
  flashEl.style.opacity=.6; requestAnimationFrame(()=> flashEl.style.opacity=0);
  const p = this.add.particles(b.x, b.y, 'white', { lifespan:600, speed:{min:80,max:220}, quantity:30, scale:{start:1.2,end:0}, tint:[0xff3b5a,0xffcc66,0xffffff]});
  this.time.delayedCall(600, ()=>p.destroy());
  Audio.boom();

  // small penalty (optional)
  Save.data.lives = Math.max(0, Save.data.lives-1);
  refreshHUD(); Save.save();
  if(Save.data.lives<=0) levelEnd.call(this,false);
}

function levelEnd(win){
  this.scene.pause();
  // Level up by XP if enough
  let leveled=false;
  while(Save.data.xp >= xpNeeded(Save.data.level)){ Save.data.xp -= xpNeeded(Save.data.level); Save.data.level++; Save.data.lives = Math.min(5, Save.data.lives+1); leveled=true; }
  if(leveled) Audio.level();
  Save.save();

  showOverlay(win ? 'Level cleared!' : 'Level failed',
              win ? `Collected ${collected}/${goal}.` : `Goal was ${goal}. Try again.`,
              { next:win, restart:true, start:false, resume:false });
}

/* ====== Overlay controls ====== */
function showOverlay(title, text, opts={}){
  ovTitle.textContent=title; ovText.innerHTML=text;
  btnStart.style.display = opts.start?'':'none';
  btnResume.style.display= opts.resume?'':'none';
  btnNext.style.display  = opts.next?'':'none';
  btnRestart.style.display=opts.restart?'':'none';
  overlay.style.display='';
  refreshHUD();
}
function hideOverlay(){ overlay.style.display='none'; }
showOverlay('Neon Orbit', `Collect <b>icons</b> (3 types), avoid <b>bombs</b>.<br>Each icon has different value; bombs explode with FX & sound.`, { start:true });

btnStart.onclick = ()=>{ hideOverlay(); game.scene.restart(); };
btnResume.onclick= ()=>{ hideOverlay(); game.scene.resume(); };
btnNext.onclick  = ()=>{ Save.data.level++; Save.save(); hideOverlay(); game.scene.restart(); };
btnRestart.onclick=()=>{ Save.data.lives=3; Save.save(); hideOverlay(); game.scene.restart(); };

// Pause when tab hidden
document.addEventListener('visibilitychange', ()=>{
  if(document.hidden){ showOverlay('Paused','',{resume:true,restart:true}); }
});
</script>
</body>
</html>
